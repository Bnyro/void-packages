# Template file for 'tutanota-desktop'
pkgname=tutanota-desktop
version=3.117.0
revision=1
archs="x86_64*"
hostmakedepends="nodejs python3 pkg-config"
makedepends="libsecret-devel"
short_desc="Official Tutanota email client"
maintainer="Bnyro <bnyro@tutanota.com>"
license="GPL-3.0-only"
homepage="https://tutanota.com/blog/posts/desktop-clients/"
distfiles="https://github.com/tutao/tutanota/archive/refs/tags/tutanota-desktop-release-${version}.tar.gz"
checksum=f1aaf14bee741f05f1980f64a210efc36d56248259397717ead7f36356b2b189

do_build() {
	npm ci
	npm run build-packages
	node desktop --custom-desktop-release --unpacked
}

do_install() {
	vmkdir opt/${pkgname}
	vmkdir usr/bin
	vcopy build/desktop/linux-unpacked/* opt/${pkgname}
	ln -sf /opt/${pkgname}/${pkgname} ${DESTDIR}/usr/bin/${pkgname}
	for x in 16x16 32x32 256x256 512x512; do
		vinstall "resources/desktop-icons/logo-solo-red.png.iconset/icon_${x}.png" 644 "usr/share/icons/hicolor/${x}/apps/${pkgname}.png"
	done
	vinstall "${FILESDIR}/${pkgname}.desktop" 644 usr/share/applications
}
